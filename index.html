<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á€á€°á€”á€¬á€•á€¼á€¯á€–á€¼á€…á€ºá€™á€šá€·á€º á€Šá€®á€™á€œá€±á€¸á€¡á€á€½á€€á€º á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€…á€‰á€º</title>
    <style>
        :root { --p-soft: #fff0f6; --p-main: #ff85c0; --p-dark: #eb2f96; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--p-soft); padding: 15px; margin: 0; color: #333; font-weight: 900; }
        .container { max-width: 450px; margin: auto; }
        .header { background: white; padding: 20px; border-radius: 20px; text-align: center; border: 2.5px solid var(--p-main); margin-bottom: 15px; }
        h2 { color: var(--p-dark); margin: 0; font-size: 20px; }
        .date-box { font-size: 14px; color: #888; margin-top: 5px; }
        .section-title { font-size: 14px; color: white; background: var(--p-main); padding: 5px 15px; border-radius: 20px; display: inline-block; margin: 15px 0 10px; }
        .task-card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .task-row { display: flex; align-items: center; gap: 12px; }
        input[type="checkbox"] { width: 22px; height: 22px; accent-color: var(--p-dark); cursor: pointer; }
        .task-text { font-size: 16px; flex-grow: 1; }
        .note-input { width: 100%; border: none; border-bottom: 1px dashed #ddd; padding: 5px 0; font-size: 12px; color: #666; outline: none; margin-top: 8px; background: transparent; }
        .time-box { display: inline-flex; align-items: center; background: #e8f5e9; color: #2e7d32; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-top: 5px; border: 1px solid #c8e6c9; }
        .loader { display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.7); z-index: 100; justify-content: center; align-items: center; }
        .footer { text-align: center; font-size: 10px; color: #ccc; margin-top: 20px; padding-bottom: 20px; }
    </style>
</head>
<body>

<div id="loading" class="loader">âš™ï¸ á€…á€¬á€›á€„á€ºá€¸á€…á€…á€ºá€”á€±á€á€Šá€º...</div>

<div class="container">
    <div class="header">
        <h2>ğŸ©º á€á€°á€”á€¬á€•á€¼á€¯á€–á€¼á€…á€ºá€™á€šá€·á€º á€Šá€®á€™á€œá€±á€¸á€¡á€á€½á€€á€º á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€…á€‰á€º ğŸŒ¸</h2>
        <div class="date-box" id="todayDate"></div>
    </div>

    <div id="taskList">
        <div class="section-title">ğŸŒ… á€™á€”á€€á€ºá€•á€­á€¯á€„á€ºá€¸ (á†:á€á€ á€¡á€­á€•á€ºá€›á€¬á€‘)</div>
        <script>
            const tasks = [
                {id: 't1', text: 'á€¡á€­á€•á€ºá€›á€¬á€á€­á€™á€ºá€¸á€á€¼á€„á€ºá€¸'}, {id: 't2', text: 'á€™á€»á€€á€ºá€”á€¾á€¬á€á€…á€ºáŠ á€á€½á€¬á€¸á€á€­á€¯á€€á€º'},
                {id: 't3', text: 'á€á€¶á€™á€¼á€€á€ºá€…á€Šá€ºá€¸á€œá€¾á€Šá€ºá€¸á€á€¼á€„á€ºá€¸'}, {id: 't4', text: 'á€›á€±á€á€»á€­á€¯á€¸á€á€¼á€„á€ºá€¸'},
                {id: 't5', text: 'á€˜á€¯á€›á€¬á€¸á€•á€”á€ºá€¸á€¡á€­á€¯á€¸á€œá€²á€á€¼á€„á€ºá€¸'}, {id: 't6', text: 'á€‘á€™á€„á€ºá€¸á€¡á€­á€¯á€¸á€á€Šá€ºá€á€¼á€„á€ºá€¸'}
            ];
            const eveningTasks = [
                {id: 't7', text: 'á€›á€±á€á€»á€­á€¯á€¸á€á€¼á€„á€ºá€¸'}, {id: 't8', text: 'á€€á€­á€¯á€šá€ºá€œá€€á€ºá€á€”á€·á€ºá€›á€¾á€„á€ºá€¸á€›á€±á€¸'},
                {id: 't9', text: 'á€…á€¬á€€á€»á€€á€ºá€á€¼á€„á€ºá€¸'}, {id: 't10', text: 'á€¡á€‘á€á€ºá€•á€Šá€¬á€á€…á€ºá€á€¯á€á€¯á€œá€±á€·á€œá€¬á€á€¼á€„á€ºá€¸'},
                {id: 't11', text: 'á€™á€­á€á€¬á€¸á€…á€¯á€”á€²á€·á€¡á€á€»á€­á€”á€ºá€•á€±á€¸á€á€¼á€„á€ºá€¸'}, {id: 't12', text: 'á€˜á€¯á€›á€¬á€¸á€›á€¾á€­á€á€­á€¯á€¸á€•á€¼á€®á€¸á€¡á€­á€•á€ºá€á€¼á€„á€ºá€¸'}
            ];

            function renderTasks(list, containerId) {
                list.forEach(t => {
                    document.write(`
                        <div class="task-card">
                            <div class="task-row"><input type="checkbox" id="${t.id}" onchange="syncToCloud('${t.id}', '${t.text}')"><span class="task-text">${t.text}</span></div>
                            <div id="s${t.id.substring(1)}"></div>
                            <input type="text" id="n${t.id.substring(1)}" class="note-input" placeholder="á€™á€¾á€á€ºá€á€»á€€á€ºá€›á€±á€¸á€›á€”á€º..." onblur="syncToCloud('${t.id}', '${t.text}')">
                        </div>
                    `);
                });
            }
            renderTasks(tasks);
            document.write('<div class="section-title">ğŸŒ‡ á€Šá€”á€±á€•á€­á€¯á€„á€ºá€¸ (á€€á€»á€±á€¬á€„á€ºá€¸á€•á€¼á€”á€ºá€›á€±á€¬á€€á€ºá€á€»á€­á€”á€º)</div>');
            renderTasks(eveningTasks);
        </script>
    </div>

    <div class="footer">ğŸŒ¸ á€Šá€®á€™á€œá€±á€¸á€¡á€á€½á€€á€º á€¡á€á€»á€…á€ºá€™á€»á€¬á€¸á€…á€½á€¬á€–á€¼á€„á€·á€º ğŸŒ¸</div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw5Hu2VjjNGCb5j0ZfCxpsNPpJrHGZGzHt5UX0q1qUwAShm94eOLFhoaXCYJYChXYx59A/exec";

    window.onload = function() {
        document.getElementById('todayDate').innerText = "á€šá€”á€±á€·á€›á€€á€ºá€…á€½á€² - " + new Date().toLocaleDateString();
        checkDailyReset();
        loadFromCloud(); 
    };

    function checkDailyReset() {
        const lastDate = localStorage.getItem('nurse_date');
        const today = new Date().toLocaleDateString();
        if (lastDate !== today) {
            localStorage.clear();
            localStorage.setItem('nurse_date', today);
        }
    }

    async function loadFromCloud() {
        document.getElementById('loading').style.display = 'flex';
        try {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            data.forEach(row => {
                const cb = document.getElementById(row[1]);
                const sp = document.getElementById('s' + row[1].substring(1));
                const noteInput = document.getElementById('n' + row[1].substring(1));
                if (cb && row[2]) {
                    cb.checked = true;
                    sp.innerHTML = `<div class="time-box">âœ… á€•á€¼á€®á€¸á€…á€®á€¸á€á€»á€­á€”á€º - ${row[3]}</div>`;
                }
                if (noteInput && row[4]) noteInput.value = row[4];
            });
        } catch (e) { console.log("Offline mode"); }
        document.getElementById('loading').style.display = 'none';
    }

    async function syncToCloud(id, name) {
        const cb = document.getElementById(id);
        const sp = document.getElementById('s' + id.substring(1));
        const note = document.getElementById('n' + id.substring(1)).value;
        let time = "";

        if (cb.checked) {
            const now = new Date();
            time = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
            sp.innerHTML = `<div class="time-box">âœ… á€•á€¼á€®á€¸á€…á€®á€¸á€á€»á€­á€”á€º - ${time}</div>`;
        } else {
            sp.innerHTML = "";
        }

        // á€”á€±á€¬á€€á€ºá€€á€½á€šá€ºá€€á€”á€± Cloud á€á€­á€¯á€·á€•á€­á€¯á€·á€™á€Šá€º (no-cors á€á€¯á€¶á€¸á€á€¼á€„á€ºá€¸á€–á€¼á€„á€·á€º á€•á€­á€¯á€™á€¼á€”á€ºá€…á€±á€á€Šá€º)
        fetch(SCRIPT_URL, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify({ id, status: cb.checked, time, note })
        });
    }
</script>
</body>
</html>
